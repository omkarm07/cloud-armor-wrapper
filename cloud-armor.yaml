project_id: "aqueous-cabinet-438912-q0"
name: "trial"
description: "CA Policy"
default_rule_action: "allow"
type: "CLOUD_ARMOR"

security_rules:
  deny_project_bad_actor1:
    action: deny(502)
    description: Deny Malicious IP address from project bad_actor1
    preview: true
    priority: 11
    src_ip_ranges:
    - 190.217.68.211/32
    - 45.116.227.68/32
    - 103.43.141.122
    - 123.11.215.36
    - 123.11.215.37
  rate_ban_project_actor3:
    action: rate_based_ban
    description: Rate based ban for address from project actor3 only if they cross
      banned threshold
    priority: 14
    rate_limit_options:
      ban_duration_sec: 600
      ban_http_request_count: 1000
      ban_http_request_interval_sec: 300
      enforce_on_key: ALL
      exceed_action: deny(502)
      rate_limit_http_request_count: 10
      rate_limit_http_request_interval_sec: 60
    src_ip_ranges:
    - 190.217.68.213
    - 45.116.227.70
custom_rules:
  allow_path_token_header:
    action: allow
    description: Allow path and token match with addition of header
    expression: "request.path.matches('/login.html') && token.recaptcha_session.score
      < 0.2\n"
    header_action:
    - header_name: reCAPTCHA-Warning
      header_value: high
    - header_name: X-Resource
      header_value: test
    priority: 25
  deny_specific_ip:
    action: deny(502)
    description: Deny specific IP address in US Region
    expression: 'origin.region_code == "US" && inIpRange(origin.ip, ''47.185.201.159/32'')'
    priority: 22
  deny_specific_regions:
    action: deny(502)
    description: Deny specific Regions
    expression: "'[AU,BE]'.contains(origin.region_code)\n"
    priority: 21
pre_configured_rules:
  php-stable_level_0_with_include:
    action: deny(502)
    description: PHP Sensitivity Level 0 with included rules
    include_target_rule_ids:
    - owasp-crs-v030301-id933190-php
    - owasp-crs-v030301-id933111-php
    priority: 3
    target_rule_set: php-v33-stable
  sqli_sensitivity_level_4:
    action: deny(502)
    description: sqli-v33-stable Sensitivity Level 4 and 2 preconfigured_waf_config_exclusions
    priority: 1
    sensitivity_level: 4
    target_rule_set: sqli-v33-stable
  xss-stable_level_2_with_exclude:
    action: deny(502)
    description: XSS Sensitivity Level 2 with excluded rules
    exclude_target_rule_ids:
    - owasp-crs-v030301-id941380-xss
    - owasp-crs-v030301-id941280-xss
    preview: true
    priority: 2
    sensitivity_level: 2
    target_rule_set: xss-v33-stable
# threat_intelligence_rules:
#   deny_malicious_ips:
#     action: deny(502)
#     description: Deny IP addresses known to attack web applications
#     exclude_ip: "['47.100.100.100', '47.189.12.139']"
#     feed: iplist-known-malicious-ips
#     preview: false
#     priority: 200
